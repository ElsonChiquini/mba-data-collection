Projeto MBA Data Collection
IngestÃ£o e Processamento de Dados no MinIO (Camadas Bronze â†’ Silver)

1ï¸âƒ£ LÃ³gica da SoluÃ§Ã£o

A pipeline foi estruturada em duas camadas principais â€” Bronze e Silver â€” armazenadas no MinIO, simulando um Data Lake corporativo.

A camada Bronze guarda os dados no formato mais prÃ³ximo do original (raw).
A camada Silver aplica o tratamento, normalizaÃ§Ã£o e tipagem dos dados, gerando arquivos Parquet prontos para anÃ¡lise.

| Tipo           | Fonte                                                       | DescriÃ§Ã£o                                                                 |
| -------------- | ----------------------------------------------------------- | ------------------------------------------------------------------------- |
| Banco de dados | PostgreSQL (`db_loja`)                                      | Tabelas transacionais simuladas (categorias, clientes, pedidos, produtos) |
| Arquivos JSON  | `json/` local                                               | Dados aninhados de sistemas externos                                      |
| API PÃºblica    | [BrasilAPI - IBGE](https://brasilapi.com.br/api/ibge/uf/v1) | Lista de estados brasileiros (UFs)                                        |

Etapas da Pipeline
Camada Bronze (Raw)

ingest_dbloja.py
Extrai dados do schema db_loja e envia para o bucket data-ingest/bronze/dbloja/ em formato Parquet.
As tabelas categorias_produto, cliente, pedido_cabecalho e pedido_itens sÃ£o processadas em Full Load, enquanto produto usa ingestÃ£o incremental.

controle_produto.py
Implementa o controle de marca dâ€™Ã¡gua (watermark).
O script lÃª o arquivo watermark_produto.txt para saber a Ãºltima data processada (data_atualizacao).
Apenas registros com data_atualizacao maior que a Ãºltima marca sÃ£o ingeridos.
ApÃ³s a execuÃ§Ã£o, o watermark Ã© atualizado.

Exemplo de controle:

watermark_produto.txt
2025-11-01T14:10:42


upload_jsons_to_minio.py
Copia os arquivos .json da pasta local para o MinIO com timestamp automÃ¡tico no nome:

bronze/json/dados_pedidos_20251031_224217.json


ingest_ibge_brasilapi_to_minio.py
Faz o consumo da BrasilAPI (endpoint /ibge/uf/v1) e salva o retorno:

bronze/api/ibge_uf/ibge_uf_data_20251031_224147.json


listar_bronze_minio.py
Lista todos os objetos armazenados na camada Bronze.

Camada Silver (Trusted)

new_script_silver.py
LÃª os Parquets da Bronze e escreve novos Parquets tratados na Silver.
Para produto, Ã© feito um Merge (Upsert) conforme id_produto, mantendo apenas registros mais recentes.

new_script_silver_json.py
Normaliza os arquivos JSON (explode arrays, trata colunas nulas, cria tabelas auxiliares):

transacoes/
pedidos_externos/
pedidos_externos_itens/
produtos_parceiros/
tags_produtos/


new_script_silver_ibge_final.py
LÃª o JSON da BrasilAPI e aplica schema fixo (id, sigla, nome).

2ï¸âƒ£ DecisÃµes de Design
| DecisÃ£o                      | Justificativa                                               |
| ---------------------------- | ----------------------------------------------------------- |
| **MinIO como Data Lake**     | Ambiente leve e compatÃ­vel com AWS S3                       |
| **Particionamento temporal** | Estrutura `data=YYYYMMDD/` garante histÃ³rico e incremental  |
| **Parquet**                  | Otimiza leitura e compressÃ£o                                |
| **Watermark local**          | Evita reprocessamento e mantÃ©m histÃ³rico incremental        |
| **Merge (Upsert)**           | Atualiza registros sem duplicaÃ§Ã£o                           |
| **Scripts modulares**        | ExecuÃ§Ã£o isolada ou completa via `orchestrator_pipeline.py` |
| **SDK MinIO**                | Facilita leitura e escrita diretas em buckets               |

3ï¸âƒ£ ExecuÃ§Ã£o dos Scripts
ğŸ”§ PrÃ©-requisitos

Python 3.10+

Servidor MinIO ativo (http://localhost:9000)

Bucket data-ingest criado

Instalar dependÃªncias:

pip install -r requirements.txt

ExecuÃ§Ã£o Passo a Passo
1ï¸âƒ£ IngestÃ£o Bronze
python script/ingest_dbloja.py
python script/controle_produto.py   # opcional, se banco real estiver conectado
python script/upload_jsons_to_minio.py
python script/ingest_ibge_brasilapi_to_minio.py

2ï¸âƒ£ DiagnÃ³stico
python script/listar_bronze_minio.py

3ï¸âƒ£ Processamento Silver
python script/new_script_silver.py
python script/new_script_silver_json.py
python script/new_script_silver_ibge_final.py

4ï¸âƒ£ Pipeline completa
python script/orchestrator_pipeline.py

4ï¸âƒ£ EvidÃªncias â€” Estrutura Final no MinIO

-------------------------------------------------------------
ğŸ¥‰ Camada Bronze

Estrutura geral da Bronze


Subpasta json/ â€” arquivos extraÃ­dos


Subpasta api/ibge_uf/ â€” dados da BrasilAPI


Subpasta dbloja/data="data do upload"/ â€” dados Parquet


Watermark salva apÃ³s execuÃ§Ã£o incremental

ğŸ¥ˆ Camada Silver

Estrutura geral do Data Lake


Camada Silver completa (/prata/)


Subpasta ibge_uf


Subpasta dbloja


Subpasta json

Autores:
Cristina Alves
Elson Chiquini
Gabriel Carille

OrganizaÃ§Ã£o do RepositÃ³rio

ğŸ“‚ /mba-data-collection
â”œâ”€â”€ /script/
â”‚   â”œâ”€â”€ ingest_dbloja.py
â”‚   â”œâ”€â”€ controle_produto.py
â”‚   â”œâ”€â”€ upload_jsons_to_minio.py
â”‚   â”œâ”€â”€ ingest_ibge_brasilapi_to_minio.py
â”‚   â”œâ”€â”€ listar_bronze_minio.py
â”‚   â”œâ”€â”€ new_script_silver.py
â”‚   â”œâ”€â”€ new_script_silver_json.py
â”‚   â”œâ”€â”€ new_script_silver_ibge_final.py
â”‚   â””â”€â”€ orchestrator_pipeline.py
â”œâ”€â”€ /json/
â”‚   â””â”€â”€ arquivos .json usados como fonte
â”œâ”€â”€ /evidencias/
â”‚   â””â”€â”€ imagens do console MinIO
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md


